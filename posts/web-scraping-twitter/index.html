<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Web Scraping (Twitter)</title>
    <meta name="description" content="Program Built to Scrape Twitter/X for Tweets to Make Comprehensive Datasets">
    <meta name="keywords" content='blog, gokarna, hugo, Data Analytics, Portfolio, Python, HTML, JavaScript, Web Scraping'>

    <meta property="og:url" content="https://keisha-g.github.io/posts/web-scraping-twitter/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Web Scraping (Twitter)">
    <meta property="og:description" content="Program Built to Scrape Twitter/X for Tweets to Make Comprehensive Datasets">
    <meta property="og:image" content="https://keisha-g.github.io/images/avatar.webp">
    <meta property="og:image:secure_url" content="https://keisha-g.github.io/images/avatar.webp">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Web Scraping (Twitter)">
    <meta name="twitter:description" content="Program Built to Scrape Twitter/X for Tweets to Make Comprehensive Datasets">
    <meta property="twitter:domain" content="https://keisha-g.github.io/posts/web-scraping-twitter/">
    <meta property="twitter:url" content="https://keisha-g.github.io/posts/web-scraping-twitter/">
    <meta name="twitter:image" content="https://keisha-g.github.io/images/avatar.webp">

    
    <link rel="canonical" href="https://keisha-g.github.io/posts/web-scraping-twitter/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.315e3e4471e2465f34b6c92d59edceac6f6b3d3844df51bbaac4e5f7227b04e4.js" integrity="sha256-MV4&#43;RHHiRl80tsktWe3OrG9rPThE31G7qsTl9yJ7BOQ="></script>

    
    
        <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          // customised options
          // • auto-render specific keys, e.g.:
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
          ],
          // • rendering keys, e.g.:
          throwOnError : false
        });
      });
    </script>
  
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://keisha-g.github.io/">
                <img src='/images/avatar.webp' alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://keisha-g.github.io/">Data Analytics Portfolio</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://keisha-g.github.io/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://keisha-g.github.io/posts/"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://keisha-g.github.io/projects/"><span data-feather='code'></span> Projects </a>
            </div>
            
            <div class="nav-link">
                <a href="https://keisha-g.github.io/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://keisha-g.github.io/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://keisha-g.github.io/posts/"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://keisha-g.github.io/projects/"><span data-feather='code'></span> Projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://keisha-g.github.io/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Web Scraping (Twitter)</h1>
        <small role="doc-subtitle">Program Built to Scrape Twitter/X for Tweets to Make Comprehensive Datasets</small>
        <p class="post-date">January 14, 2024
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://keisha-g.github.io/tags/python">Python</a></li>
        
            <li class="post-tag"><a href="https://keisha-g.github.io/tags/html">HTML</a></li>
        
            <li class="post-tag"><a href="https://keisha-g.github.io/tags/javascript">JavaScript</a></li>
        
            <li class="post-tag"><a href="https://keisha-g.github.io/tags/data-analytics">Data Analytics</a></li>
        
            <li class="post-tag"><a href="https://keisha-g.github.io/tags/web-scraping">Web Scraping</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>For my honours project (for more details, check the &lsquo;Projects&rsquo; tab), I needed to build a program that would scrape Twitter/X for tweets. This was done using the <a href="https://github.com/JustAnotherArchivist/snscrape">snscrape library</a> and Python. This project also had a front-end interface in order to give the program inputs instead of doing it through the CLI.</p>
<p>The program takes in the number of total tweets wanted and what hashtag you want the scraper to crawl through to collect them. For example, input to the program could be (1500, &ldquo;Fashion&rdquo;). The front end interface is just a basic webpage with a a few textboxes and a button that is connected to javascript as seen below. When clicked, the javascript sends the information in the textboxes to the Python code which then the program can start scraping the tweets with the desired inputs.</p>
<p><img src="/images/Twitter-Scraper/Front-end-Scraper.png" alt="Front-End-Twitter-Scraper"></p>
<p>Once the infromation is received, the &lsquo;scrape&rsquo; method which is pictured below is run. The parameters &lsquo;query&rsquo; and &rsquo;tweet_num&rsquo; in the below method are the respective paramteres received from the front-end user. After the first few lines of instilising all these values, there is then a for loop. Essentially what this block of code is doing is accessing the live stream of tweets being posted to X/Twitter in a particular hashtag and stops once it has accessed the number defined by the user.</p>
<p>The tweets gathered is then converted into an excel file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> snscrape.modules.twitter <span style="color:#66d9ef">as</span> sntwitter
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TwitterScraper</span>:
</span></span><span style="display:flex;"><span>    query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;placeholder&#34;</span>
</span></span><span style="display:flex;"><span>    tweet_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">scrape</span>(self, query, tweet_num):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>query <span style="color:#f92672">=</span> query
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tweet_num <span style="color:#f92672">=</span> int(tweet_num) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        tweets <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, tweet <span style="color:#f92672">in</span> enumerate(sntwitter<span style="color:#f92672">.</span>TwitterHashtagScraper(query)<span style="color:#f92672">.</span>get_items()):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> i<span style="color:#f92672">&gt;</span>int(tweet_num):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            tweets<span style="color:#f92672">.</span>append([tweet<span style="color:#f92672">.</span>date, tweet<span style="color:#f92672">.</span>id, tweet<span style="color:#f92672">.</span>content, tweet<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>username, tweet<span style="color:#f92672">.</span>retweetCount,
</span></span><span style="display:flex;"><span>            tweet<span style="color:#f92672">.</span>replyCount, tweet<span style="color:#f92672">.</span>likeCount, tweet<span style="color:#f92672">.</span>quoteCount, tweet<span style="color:#f92672">.</span>lang, tweet<span style="color:#f92672">.</span>media, tweet<span style="color:#f92672">.</span>url])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> tweet<span style="color:#f92672">.</span>media <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>download_image(tweet<span style="color:#f92672">.</span>media, i)
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>        tweets_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(tweets, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Datetime&#39;</span>, <span style="color:#e6db74">&#39;Tweet_Id&#39;</span>, <span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Username&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Retweet_Count&#39;</span>, <span style="color:#e6db74">&#39;Reply_Count&#39;</span>, <span style="color:#e6db74">&#39;Like_Count&#39;</span>, <span style="color:#e6db74">&#39;Quote_Count&#39;</span>, <span style="color:#e6db74">&#39;Language&#39;</span>, <span style="color:#e6db74">&#39;media&#39;</span>, <span style="color:#e6db74">&#39;URL&#39;</span>])
</span></span><span style="display:flex;"><span>        tweets_json <span style="color:#f92672">=</span> tweets_df<span style="color:#f92672">.</span>to_json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;C:\Users\FILEPATH...&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>) <span style="color:#66d9ef">as</span> f:        
</span></span><span style="display:flex;"><span>            tweets_df<span style="color:#f92672">.</span>to_csv(f, header<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Datetime&#39;</span>, <span style="color:#e6db74">&#39;Tweet_Id&#39;</span>, <span style="color:#e6db74">&#39;Text&#39;</span>, <span style="color:#e6db74">&#39;Username&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Retweet_Count&#39;</span>, <span style="color:#e6db74">&#39;Reply_Count&#39;</span>, <span style="color:#e6db74">&#39;Like_Count&#39;</span>, <span style="color:#e6db74">&#39;Quote_Count&#39;</span>, <span style="color:#e6db74">&#39;Language&#39;</span>, <span style="color:#e6db74">&#39;media&#39;</span>, <span style="color:#e6db74">&#39;URL&#39;</span>])
</span></span></code></pre></div><p>Though, for my dataset, I also wanted the pictures that users had attatched to thier tweets. In a hashtag like &ldquo;fashion&rdquo; for example, the pictures would be very important - the tweet is practically incomplete without it! So, the line <code>if tweet.media != None:</code> checks if the tweet has pictures. If it does, it then runs <code>self.download_image(tweet.media, i)</code> which downloads the images from the image and names it in a way that connects the image to the tweet ID (so the iamge and the tweet text can be connected later). The code to do this can be seen below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">download_image</span>(self, tweet_media_list, index):
</span></span><span style="display:flex;"><span>        images_in_tweet <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tweet_media_list:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_photo(str(i)):
</span></span><span style="display:flex;"><span>                media_url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>extract_file_name(str(i))
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;C:\Users\FILEPATH...&#39;</span> <span style="color:#f92672">+</span> str(index) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> str(images_in_tweet) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>
</span></span><span style="display:flex;"><span>           
</span></span><span style="display:flex;"><span>                img_data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(media_url)<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(file_name, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> handler:
</span></span><span style="display:flex;"><span>                    handler<span style="color:#f92672">.</span>write(img_data)
</span></span><span style="display:flex;"><span>                images_in_tweet <span style="color:#f92672">=</span> images_in_tweet <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_file_name</span>(self, media_string):
</span></span><span style="display:flex;"><span>        media_url <span style="color:#f92672">=</span> media_string
</span></span><span style="display:flex;"><span>        media_url <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;fullUrl=</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">.+</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>, media_url)<span style="color:#f92672">.</span>group()
</span></span><span style="display:flex;"><span>        media_url <span style="color:#f92672">=</span> media_url<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;fullUrl=</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        media_url <span style="color:#f92672">=</span> media_url<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> media_url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_photo</span>(self, media_string):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> media_string[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;P&#39;</span>
</span></span></code></pre></div><p>A tweet can have multiple images which is why the &lsquo;download iamge&rsquo; method has a loop. It checks if the media attatched to the tweet is a photo by calling <code>def is_photo</code> (media could also be a video) and then if it is, extracts the file download url from the chunk of data given in the tweet. We have to do this as the Twitter API does not seperate out this information. Luckily, this can easily be done ourselves using regular expressions or &lsquo;regex&rsquo; as can be seen in <code>extract_file_name</code>.</p>

        </p>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top">
        
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
    </svg>
    <script>
        let backToTopButton = document.getElementById("btt-button");

        window.onscroll = function() {
            scrollFunction()
        };

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        }

        function topFunction() {
            smoothScrollToTop();
        }

        function smoothScrollToTop() {
            const scrollToTop = () => {
                const c = document.documentElement.scrollTop || document.body.scrollTop;
                if (c > 0) {
                    window.requestAnimationFrame(scrollToTop);
                    window.scrollTo(0, c - c / 8);
                }
            };
            scrollToTop();
        }
    </script>
    
    
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents"></nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2024 Keisha Gordon</span>
    
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
